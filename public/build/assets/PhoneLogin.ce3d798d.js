import{d as te,Z as ae,p as re,i as p,bB as ne,j as se,c as $,b as r,a as d,w as s,h as ie,f as E,g as j,V as le,n as q,F as W,B as N,A as Z,q as i,r as f,o as _,t as l,s as de}from"./app.2982e019.js";import{f as U}from"./index.esm.8fcef60c.js";import"./auth.esm.be6b9a90.js";import{P as pe}from"./PsDropdown.3b1e9581.js";import{P as me}from"./PsDropdownSelect.b154c567.js";import ce from"./PsLabel.c51f2c9d.js";import ue from"./PsLabelTitle.ddb6fa87.js";import fe from"./PsLabelCaption.54d4aa23.js";import _e from"./PsButton.7f6705bd.js";import{P as he}from"./PsInput.8a03a303.js";import{P as ge}from"./PsCard.1a3f6d6f.js";import{b as ve}from"./PsDangerDialog.7d01f7b5.js";import be from"./UserPhoneLoginVerificationModal.694f7a7e.js";import ye from"./PsFrontendLayout.69775a00.js";import"./PsIcon.e7a5adcd.js";import{_ as ke}from"./plugin-vue_export-helper.21dcd24c.js";import"./toggle.ae92e5df.js";/* empty css                                                             */import"./PsWarningDialog.2baf785b.js";import{u as we}from"./ThemeStore.40343845.js";import"./LanguageStore.8f1cddd7.js";import"./SideMenuStore.ed2aa07c.js";import"./PsErrorDialog.ccf1ce18.js";import"./AppInfoStore.6a348fbd.js";import"./NotificationStore.af68b63a.js";import{W as Ce}from"./WelcomeImage.b46c48f6.js";import{u as Pe}from"./AppInfoStore.f8d22516.js";import{A as Se}from"./AppInfoParameterHolder.e24d894d.js";import $e from"./PsErrorDialog.d6a4d7d4.js";import{u as Ne}from"./AuthStore.abfd19f8.js";import{P as Ae}from"./PhoneLoginParameterHolder.e6dad0ed.js";import"./PsLabel.8e7b338e.js";import"./PsModal.62a4a1d3.js";import"./vue-neat-modal.2bf17e6b.js";import"./PsButton.60128369.js";import"./PsModal.36ad7f82.js";import"./PsLine.ea3266c0.js";import"./PsInput.5d0c1579.js";import"./FooterView.722f89eb.js";import"./FooterLinkSection.2922917e.js";import"./PsLink.7aa92bdc.js";import"./PsRouteLink.c57ebe2e.js";import"./PsIcon.515a10c8.js";import"./ProductParameterHolder.4354be0b.js";import"./ps_constants.0e2a11f9.js";import"./PsValueStore.eb9430a0.js";import"./CustomFieldStore.79b51a65.js";import"./PsApiService.9afc2356.js";import"./PsObject.a17ef38f.js";import"./DefaultPhoto.cc755f93.js";import"./PsStore.6f734180.js";import"./PsSepetetedStore.9a31ac47.js";import"./PsNavTabBar.a1e78a20.js";import"./PsDropdown.2a6cc373.js";import"./PsDropdownSelect.ce61e1c2.js";import"./PsIconToggle.e81615f0.js";import"./PsInputWithLeftIcon.f3f18e1b.js";import"./ItemLocationTownshipStore.fe0ada29.js";import"./ItemLocation.d1b92a80.js";import"./LocationParameterHolder.9e411c2e.js";import"./PsUtils.bbfda905.js";import"./PsNavBar.15a584b5.js";import"./UserStore.cc6d36cc.js";import"./User.0c3ba1a8.js";import"./RatingDetail.291ad5d1.js";import"./ProductRelation.0b376978.js";import"./UserListParameterHolder.d110b747.js";import"./ApiStatus.5720ba0b.js";import"./UserUnReadMessageParameterHolder.81a68b74.js";import"./AddToCartStore.71386b4c.js";import"./PsNotificationBox.7fffda98.js";import"./index.esm.7ce161a7.js";import"./ProductStore.a3320c3f.js";import"./Phone.45f97258.js";import"./Product.29c94914.js";import"./Category.7c65464b.js";import"./DefaultIcon.e76b39a5.js";import"./SubCategory.1b4176e0.js";import"./ItemCurrency.91c8ce91.js";import"./Vendor.d946ee87.js";import"./UserDeleteItemParameterHolder.5d816aba.js";import"./NotificationStore.cd066252.js";import"https://unpkg.com/delayed-scroll-restoration-polyfill@0.1.1/index.js";import"./NotiUnRegisterHolder.eefb692e.js";import"./Icons.c01eddd9.js";const Ve=te({name:"PhoneLoginView",components:{Head:ae,Link:re,PsLabel:ce,PsLabelTitle:ue,PsButton:_e,PsInput:he,UserPhoneLoginVerificationModal:be,PsErrorDialog:$e,PsLabelCaption:fe,PsCard:ge,PsDangerDialog:ve,WelcomeImage:Ce,PsDropdown:pe,PsDropdownSelect:me},props:{backendSetting:Object,status:String,error:String,errors:Object,phoneCodes:Object,firebaseConfig:String},layout:ye,setup(e){var H,K,F,O;const t=Ne(),w=new Ae,T=we(),M=p(),B=p(),A=p(),P=p(),b=p(),v=Pe();let o=ne({email:"",password:"",remember:!1,deviceToken:"",headerToken:"",loginMethod:"",google_id:"",profile_photo_url:"",name:"",displayName:"",registerMethod:"",user_phone:"",username:"",phone_id:"",phone_code:(O=(F=(K=(H=v==null?void 0:v.appInfo)==null?void 0:H.data)==null?void 0:K.defaultPhoneCountryCode)==null?void 0:F.id)!=null?O:"1",phone_string:""});const y=JSON.parse(e.firebaseConfig);U.apps.length<1&&U.initializeApp(y);const h=p(),C=p(),k=p(),I=p(),V=p(!1),x=p(!1),n=p(),D=p(),R=p(!1);let L,m,z;t.loading.value=!1;function J(){t.loading.value=!0,setTimeout(()=>{window.recaptchaVerifier=new U.auth.RecaptchaVerifier("recaptcha-container",{size:"invisible",callback:a=>{console.log("Callback"),console.log(a)},"expired-callback":()=>{console.log("expiry callback")}}),z=window.recaptchaVerifier,t.loading.value=!1},1e3)}se(async()=>{var g,c,u,S;J();const a=new Se;a.userId="nologinuser",await v.loadAppInfo(a),o.phone_code=(S=(u=(c=(g=v==null?void 0:v.appInfo)==null?void 0:g.data)==null?void 0:c.defaultPhoneCountryCode)==null?void 0:u.id)!=null?S:"1"});function G(){N.get(route("login"))}async function Q(){P.value="",L!=null&&await L.confirm(I.value).then(async a=>{if(a!=null&&a.user!=null&&a.user.uid!=null&&a.user.uid!=""){const g=a.user;w.phoneId=g.uid,t.loading.value=!0,m.data.message.user_isexisted=="2"&&(o.loginMethod="phone",o.username=h.value,o.user_phone=C.value,o.phone_id=g.uid,N.post(route("CreateLogin"),o,{})),m.data.message.user_isexisted=="1"&&(o.loginMethod="phone",o.username=h.value,o.email="admin@gmail.com",o.user_phone=C.value,o.password="admin@123",o.phone_id=g.uid,o.name=h.value,N.post(route("login"),o,{}))}else t.setLoading(!1)}).catch(a=>{t.setLoading(!1),P.value=a==null?void 0:a.message})}async function X(){let a=e.phoneCodes.filter(c=>c.id==o.phone_code)[0].country_code;C.value=a+o.phone_string,k.value=a+"-"+o.phone_string,w.userName=h.value,w.userPhone=k.value,w.displayName=o.displayName,t.loading.value=!0;const g=z;m=await t.existUser(w),m.data.status=="error"&&(M.value="",B.value="",A.value="",M.value=m.data.message.username?m.data.message.username[0]:"",B.value=m.data.message.user_phone?m.data.message.user_phone[0]:"",A.value=m.data.message.displayName?m.data.message.displayName[0]:"",t.loading.value=!1),m.data.status=="success"&&(L=await U.auth().signInWithPhoneNumber(C.value,g).catch(c=>{t.loading.value=!1,P.value=c==null?void 0:c.message}),L!=null&&n.value.openModal(Z("phone_no_verification_modal__title"),"","Submit","Cancel",async c=>{t.loading.value=!0,await L.confirm(c).then(async u=>{if(u!=null&&u.user!=null&&u.user.uid!=null&&u.user.uid!=""){const S=u.user;w.phoneId=S.uid,n.value.actionClicked("no"),m.data.message.user_isexisted=="2"&&(o.loginMethod="phone",o.username=h.value,o.user_phone=k.value,o.phone_id=S.uid,N.post(route("CreateLogin"),o,{})),m.data.message.user_isexisted=="1"&&(o.loginMethod="phone",o.username=h.value,o.email="admin@gmail.com",o.user_phone=k.value,o.password="admin@123",o.phone_id=S.uid,o.name=h.value,N.post(route("login"),o,{}))}else t.setLoading(!1)}).catch(u=>{t.setLoading(!1),D.value.openModal(Z("phone_login__error_in_sign_in"),u==null?void 0:u.message)})},()=>{console.log("Cancel")}))}function Y(){N.post(route("login"))}function ee(a){/^\/$|(\/[a-zA-Z_0-9-]+)+$/.test(a.target.value)?V.value=!0:V.value=!1}function oe(a){/^\/$|(\/[a-zA-Z_0-9-]+)+$/.test(a.target.value)?x.value=!0:x.value=!1}return{authStore:t,clicked:X,name:h,phone:C,user_phone_login_verification_modal:n,ps_error_dialog:D,loginClicked:G,isValidUserName:V,validateName:ee,validatePhone:oe,isValidPhone:x,themeStore:T,test:Y,usernameError:M,phoneError:B,ps_danger_dialog:b,code:I,code_data_ready:R,codeClicked:Q,codeError:P,form:o,displayNameError:A}},watch:{async errors(e){this.errors.user_ban&&(this.authStore.loading.value=!1)}}}),xe={class:"flex flex-row items-center justify-center min-h-screen mb-6 bg-feAchromatic-50 dark:bg-feAchromatic-900 mt-28"},Le={class:"flex flex-row my-6 overflow-hidden rounded-md shadow-md h-176 w-98 lg:w-202"},Ee={class:"flex-col items-center justify-center hidden h-auto w-100 bg-feSecondary-900 lg:flex"},Me={class:"w-65 h-50"},Be={class:"flex-grow px-10 pb-10 bg-feAchromatic-50 dark:bg-feSecondary-800"},Ie={class:"px-6"},je={class:"flex"},Ue={class:"w-16 rounded-md shadow-xs bg-feAchromatic-50 dark:bg-feAchromatic-900"},De={class:"z-20 pt-2"},Te={key:0},ze={key:1},He=["onClick"],Ke=d("div",{id:"recaptcha-container"},null,-1),Fe=i(),Oe=d("br",null,null,-1),qe={class:"flex items-center justify-center mb-4 lg:mt-56"},We={class:"flex justify-center flex-auto mt-4 mb-10"},Ze={key:0};function Re(e,t,w,T,M,B){const A=f("Head"),P=f("welcome-image"),b=f("ps-label"),v=f("ps-label-title"),o=f("ps-input"),y=f("ps-label-caption"),h=f("ps-dropdown-select"),C=f("ps-dropdown"),k=f("ps-button"),I=f("user-phone-login-verification-modal"),V=f("ps-error-dialog"),x=f("ps-danger-dialog");return _(),$(W,null,[r(A,{title:e.$t("core__fe_sign_in")},null,8,["title"]),d("div",{class:q(e.themeStore.isDarkMode?"dark":"")},[d("div",xe,[d("div",Le,[d("div",Ee,[d("div",Me,[r(P)]),r(b,{class:"mt-6 mb-2 text-lg font-semibold",textColor:"text-feSecondary-50"},{default:s(()=>[i(l(e.$t("login__fe_title_best_deal")),1)]),_:1}),r(b,{class:"mx-10 mb-2 text-base font-normal text-center",textColor:"text-feSecondary-200"},{default:s(()=>[i(l(e.$t("login__fe_description_best_deal")),1)]),_:1})]),d("div",Be,[d("form",{onSubmit:t[4]||(t[4]=ie((...n)=>e.clicked&&e.clicked(...n),["prevent"]))},[d("div",Ie,[r(v,{class:"pt-2 pb-8 m-auto mt-10 text-center",textColor:"text-feSecondary-600 dark:text-feSecondary-50"},{default:s(()=>[i(l(e.$t("phone_login__phone_login")),1)]),_:1}),r(b,{class:"mt-4"},{default:s(()=>[i(l(e.$t("core__fe_phone_login__display_name"))+" : ",1)]),_:1}),r(o,{class:"mt-2 placeholder-feSecondary-800 dark:placeholder-feSecondary-500",type:"text",placeholder:e.$t("core__fe_phone_login__display_name_placeholder"),theme:"text-feSecondary-500 dark:bg-feSecondary-800",defaultBorder:"border border-feSecondary-200 dark:border-feSecondary-400 focus:outline-none focus:ring-1 focus:ring-fePrimary-500",value:e.form.displayName,"onUpdate:value":t[0]||(t[0]=n=>e.form.displayName=n)},null,8,["placeholder","value"]),e.isValidUserName?(_(),E(y,{key:0,class:"mx-8 mt-2",textColor:"text-fePrimary-500 dark:text-feAccent-500"},{default:s(()=>[i(l(e.$t("phone_login__user_name_required")),1)]),_:1})):j("",!0),r(y,{textColor:"text-feError-500 ",class:"block mt-2"},{default:s(()=>[i(l(e.displayName),1)]),_:1}),r(b,{class:"mt-4"},{default:s(()=>[i(l(e.$t("phone_label"))+" : ",1)]),_:1}),d("div",je,[r(C,{align:"left",class:"w-20 mt-2"},{select:s(()=>[r(h,{border:"border border-feSecondary-200 dark:border-feSecondary-400 focus:outline-none focus:ring-1 focus:ring-fePrimary-500",placeholder:"phone",showCenter:!0,selectedValue:e.form.phone_code==""?"":e.phoneCodes.filter(n=>n.id==e.form.phone_code)[0].country_code,onChange:t[1]||(t[1]=n=>[e.form.phone_code=e.phoneCode.id])},null,8,["selectedValue"])]),list:s(()=>[d("div",Ue,[d("div",De,[e.phoneCodes.length===0?(_(),$("div",Te,[r(b,{class:"flex p-2 cursor-pointer"},{default:s(()=>[i(l(e.$t("core_fe_empty_phone_list")),1)]),_:1})])):(_(),$("div",ze,[(_(!0),$(W,null,de(e.phoneCodes,n=>(_(),$("div",{key:n.id,class:"flex items-center px-2 py-4 cursor-pointer w-96 hover:bg-fePrimary-50 dark:hover:bg-feSecondary-700",onClick:D=>[e.form.phone_code=n.id]},[r(b,{class:q(["ms-2",n.id==e.form.phone_code?" font-bold":""])},{default:s(()=>[i(l(n.country_code),1)]),_:2},1032,["class"])],8,He))),128))]))])])]),_:1}),r(o,{class:"mt-2",onKeyup:le(e.clicked,["enter"]),onKeypress:e.validatePhone,type:"text",theme:"text-feSecondary-500 dark:bg-feSecondary-800",defaultBorder:"border border-feSecondary-200 dark:border-feSecondary-400 focus:outline-none focus:ring-1 focus:ring-fePrimary-500",placeholder:e.$t("phone_login__fe_phone_number_placeholderv2"),value:e.form.phone_string,"onUpdate:value":t[2]||(t[2]=n=>e.form.phone_string=n)},null,8,["onKeyup","onKeypress","placeholder","value"])]),r(y,{textColor:"text-feError-500 ",class:"block mt-2"},{default:s(()=>[i(l(e.errors.user_ban),1)]),_:1}),e.isValidPhone?(_(),E(y,{key:1,class:"mx-8 mt-2",textColor:"text-fePrimary-500 dark:text-feAccent-500"},{default:s(()=>[i(l(e.$t("phone_login__phone_required")),1)]),_:1})):j("",!0),r(y,{textColor:"text-feError-500 ",class:"block mt-2"},{default:s(()=>[i(l(e.phoneError),1)]),_:1}),e.code_data_ready?(_(),E(o,{key:2,class:"mt-4",type:"text",placeholder:e.$t("phone_login__code"),value:e.code,"onUpdate:value":t[3]||(t[3]=n=>e.code=n)},null,8,["placeholder","value"])):j("",!0),r(y,{textColor:"text-feError-500 ",class:"block mt-2"},{default:s(()=>[i(l(e.codeError),1)]),_:1}),Ke,Fe,Oe,d("div",qe,[e.authStore.loading.value?(_(),E(k,{key:0,class:"w-full mt-6",disabled:!0},{default:s(()=>[i(l(e.$t("phone_login__loading")),1)]),_:1})):(_(),E(k,{key:1,class:"w-full mt-6",onClick:e.clicked,disabled:!1},{default:s(()=>[i(l(e.$t("phone_login__login")),1)]),_:1},8,["onClick"]))]),d("div",We,[r(k,{colors:"bg-feAchromatic-50 dark:bg-feSecondary-800 dark:text-feSecondary-50 ",border:"border",class:"w-full mt-6",onClick:e.loginClicked,disabled:!1},{default:s(()=>[i(l(e.$t("core__fe_btn_cancel")),1)]),_:1},8,["onClick"])])]),e.code_data_ready?(_(),$("div",Ze)):j("",!0)],32)])])])],2),r(I,{ref:"user_phone_login_verification_modal"},null,512),r(V,{ref:"ps_error_dialog"},null,512),r(x,{ref:"ps_danger_dialog"},null,512)],64)}var Nt=ke(Ve,[["render",Re]]);export{Nt as default};
