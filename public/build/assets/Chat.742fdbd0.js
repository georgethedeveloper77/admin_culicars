import{Z as bt,i as I,B as Ut,y as Pt,j as wt,k as Et,A as x,o as a,c as g,b as m,w as d,a as c,m as ke,q as n,t as l,f as A,h as Ee,g as P,n as Oe,F as at,s as Ot,V as Bt,r as w,z as Ht}from"./app.2982e019.js";import{f as Be}from"./index.esm.8fcef60c.js";import"./auth.esm.be6b9a90.js";import"./NotificationStore.af68b63a.js";import Dt from"./PsInput.5d0c1579.js";import Rt from"./PsLine.ea3266c0.js";import Mt from"./PsContentContainer.d9cdaaa2.js";import Lt from"./PsBreadcrumb2.f58a42a7.js";import Ft from"./PsButton.7f6705bd.js";import Nt from"./PsDropdown.2a6cc373.js";import{P as b}from"./PsUtils.bbfda905.js";import Yt from"./PsIcon.515a10c8.js";import Gt from"./PsLabel.c51f2c9d.js";import Vt from"./PsLabelTitle3.30d5e369.js";import qt from"./PsRouteLink.c57ebe2e.js";import jt from"./PsLabelCaption2.b868a078.js";import{P as h}from"./ps_constants.0e2a11f9.js";import{u as zt}from"./NotificationStore.cd066252.js";import{P as Jt}from"./PsValueStore.eb9430a0.js";import Xt from"./PsLoadingDialog.9b6db1c6.js";import Kt from"./PsConfirmDialog2.0cf99ffa.js";import Wt from"./PsErrorDialog.d6a4d7d4.js";import Zt from"./PsSuccessDialog.9fead790.js";import Qt from"./ChatImageDetail.46b30bdf.js";import $t from"./OfferModal.fe6f33ff.js";import es from"./BookingModal.081cdb63.js";import ts from"./ReviewModal.b6cea4b3.js";import{u as ss}from"./GalleryStore.44618c90.js";import{c as ee}from"./PsApiService.9afc2356.js";import{u as os}from"./UserStore.cc6d36cc.js";import{u as rs}from"./GetChatHistoryStore.5646a45a.js";import{u as is}from"./AppInfoStore.f8d22516.js";import{A as as}from"./AppInfoParameterHolder.e24d894d.js";import{u as ls}from"./ChatHistoryListStore.500bae46.js";import{u as ns}from"./OfferStore.9aa6bf62.js";import{P as ds}from"./PsObject.a17ef38f.js";import{f as cs}from"./format.min.73c0dc2e.js";import ms from"./PsFrontendLayout.69775a00.js";import{u as fs}from"./ProductStore.a3320c3f.js";import{U as _s,u as us}from"./UserUnReadMessageParameterHolder.81a68b74.js";import{h as hs}from"./moment.9709ab41.js";import{_ as gs}from"./plugin-vue_export-helper.21dcd24c.js";import"./index.esm.7ce161a7.js";import"./NotiUnRegisterHolder.eefb692e.js";import"./DefaultPhoto.cc755f93.js";import"./ApiStatus.5720ba0b.js";import"./PsSepetetedStore.9a31ac47.js";import"./PsModal.36ad7f82.js";import"./vue-neat-modal.2bf17e6b.js";import"./ThemeStore.40343845.js";import"./LanguageStore.8f1cddd7.js";import"./PsLabelTitle.ddb6fa87.js";import"./PsImageModal.96f99530.js";import"./ItemCurrencyStore.63b325e3.js";import"./ItemCurrency.91c8ce91.js";import"./PsLabelHeader6.b8d308a8.js";import"./ItemEntryParameterHolder.87e7bb8d.js";import"./PsInputWithLeftIcon.f3f18e1b.js";import"./PsLabelCaption.54d4aa23.js";import"./PsDropdownSelect.ce61e1c2.js";import"./PsTimePicker.2fe6fad3.js";import"./PsDatePicker.abc8a24e.js";import"./vue3-datepicker.esm.86d67ffa.js";import"./index.19a67800.js";import"./PsUtils.84756d19.js";import"./RatingSelected.a0ab0b5b.js";import"./PsTextarea.1f96964c.js";import"./RatingHolder.d69bc41d.js";import"./User.0c3ba1a8.js";import"./RatingDetail.291ad5d1.js";import"./ProductRelation.0b376978.js";import"./UserListParameterHolder.d110b747.js";import"./ChatHistory.c3f26661.js";import"./Product.29c94914.js";import"./Category.7c65464b.js";import"./DefaultIcon.e76b39a5.js";import"./SubCategory.1b4176e0.js";import"./ItemLocation.d1b92a80.js";import"./Vendor.d946ee87.js";import"./SyncChatHistoryParameterHolder.24ffbfbb.js";import"./FooterView.722f89eb.js";import"./FooterLinkSection.2922917e.js";import"./PsLink.7aa92bdc.js";import"./ProductParameterHolder.4354be0b.js";import"./CustomFieldStore.79b51a65.js";import"./PsStore.6f734180.js";import"./PsNavTabBar.a1e78a20.js";import"./PsIconToggle.e81615f0.js";import"./ItemLocationTownshipStore.fe0ada29.js";import"./LocationParameterHolder.9e411c2e.js";import"./PsNavBar.15a584b5.js";import"./AddToCartStore.71386b4c.js";import"./PsNotificationBox.7fffda98.js";import"./Phone.45f97258.js";import"./UserDeleteItemParameterHolder.5d816aba.js";import"https://unpkg.com/delayed-scroll-restoration-polyfill@0.1.1/index.js";class ps{constructor(){this.itemId="",this.buyerUserId="",this.sellerUserId=""}GetChatHistoryParameterHolder(){this.itemId="",this.buyerUserId="",this.sellerUserId=""}toMap(){const r={};return r.item_id=this.itemId,r.buyer_user_id=this.buyerUserId,r.seller_user_id=this.sellerUserId,r}}class ys{constructor(){this.itemId="",this.buyerUserId="",this.sellerUserId="",this.negoPrice="",this.type="",this.isUserOnline="",this.message=""}MakeOfferParameterHolder(){this.itemId="",this.buyerUserId="",this.sellerUserId="",this.negoPrice="",this.type=h.CHAT_TO_SELLER,this.isUserOnline="",this.message=""}AcceptOfferParameterHolder(){this.itemId="",this.buyerUserId="",this.sellerUserId="",this.negoPrice="",this.type=h.CHAT_TO_BUYER,this.isUserOnline="",this.message=""}toMap(){const r={};return r.item_id=this.itemId,r.buyer_user_id=this.buyerUserId,r.seller_user_id=this.sellerUserId,r.nego_price=this.negoPrice,r.type=this.type,r.is_user_online=this.isUserOnline,r.message=this.message,r}}class _e{constructor(){this.addedDateTimeStamp=0,this.id="",this.isSold=!1,this.isUserBought=!1,this.itemId="",this.message="",this.offerStatus=0,this.sendByUserId="",this.sessionId="",this.type=0}ChatParameterHolder(){return this.addedDateTimeStamp=Math.floor(Date.now()),this.id="",this.isSold=!1,this.isUserBought=!1,this.itemId="",this.message="hi",this.offerStatus=h.CHAT_STATUS_NULL,this.sendByUserId="",this.sessionId="",this.type=h.CHAT_TYPE_TEXT,this}ChatAcceptParameterHolder(){return this.addedDateTimeStamp=Math.floor(Date.now()),this.id="",this.isSold=!1,this.isUserBought=!1,this.itemId="",this.message="",this.offerStatus=h.CHAT_STATUS_ACCEPT,this.sendByUserId="",this.sessionId="",this.type=h.CHAT_TYPE_ACCEPT,this}toMap(){const r={};return r.item_id=this.itemId,r.send_by_user_id=this.sendByUserId,r.message=this.message,r.type=this.type,r}}class ks{constructor(){this.itemId="",this.buyerUserId="",this.sellerUserId="",this.type=""}ResetUnReadMessageHolder(){this.itemId="",this.buyerUserId="",this.sellerUserId="",this.type=""}toMap(){const r={};return r.item_id=this.itemId,r.buyer_user_id=this.buyerUserId,r.seller_user_id=this.sellerUserId,r.type=this.type,r}}class He extends ds{constructor(){super(...arguments),this.id="",this.itemId="",this.sessionId="",this.key="",this.message="",this.type=0,this.sendByUserId="",this.offerStatus=0,this.addedDate="",this.isSold=!1,this.isUserBought=!1,this.dateTimeString="",this.dateString="",this.timeString=""}init(r,f,e,te,R,re,v,C,_,E,k,Y,j,z){return this.id=r,this.itemId=f,this.sessionId=e,this.key=te,this.message=R,this.type=re,this.sendByUserId=v,this.offerStatus=C,this.addedDate=_,this.isSold=E,this.isUserBought=k,this.dateTimeString=Y,this.dateString=j,this.timeString=z,this}getPrimaryKey(){return this.itemId}fromMap(r){return new He().init(r.id,r.itemId,r.sessionId,r.key,r.message,r.type,r.sendByUserId,r.offerStatus,r.addedDate,r.isSold,r.isUserBought,r.dateTimeString,r.dateString,r.timeString)}fromMapList(r){const f=[];for(const e in r)e!=null&&f.push(this.fromMap(e));return f}toMap(r){const f={};return f.id=r.id,f.itemId=r.itemId,f.sessionId=r.sessionId,f.key=r.key,f.message=r.message,f.type=r.type,f.sendByUserId=r.sendByUserId,f.offerStatus=r.offerStatus,f.addedDate=r.addedDate,f.isSold=r.isSold,f.isUserBought=r.isUserBought,f.dateTimeString=r.dateTimeString,f.dateString=r.dateString,f.timeString=r.timeString,f}toMapList(r){const f=[];for(let e=0;e<r.length;e++)r[e]!=null&&f.push(this.toMap(r[e]));return f}}class Ss{constructor(){this.itemId="",this.buyerUserId="",this.sellerUserId="",this.isUserOnline=""}IsUserBoughtParameterHolder(){this.itemId="",this.buyerUserId="",this.sellerUserId="",this.isUserOnline=""}toMap(){const r={};return r.item_id=this.itemId,r.buyer_user_id=this.buyerUserId,r.seller_user_id=this.sellerUserId,r.is_user_online=this.isUserOnline,r}}const xs={name:"ChatView",components:{PsLabel:Gt,PsInput:Dt,PsLine:Rt,PsContentContainer:Mt,PsIcon:Yt,PsLabelTitle3:Vt,PsLabelCaption2:jt,PsLoadingDialog:Xt,OfferModal:$t,BookingModal:es,PsConfirmDialog2:Kt,PsErrorDialog:Wt,PsSuccessDialog:Zt,ChatImageDetail:Qt,PsRouteLink:qt,ReviewModal:ts,PsBreadcrumb2:Lt,PsButton:Ft,PsDropdown:Nt,Head:bt},props:["query"],layout:ms,setup(i){var Ge,Ve,qe,je,ze,Je,Xe,Ke,We,Ze,Qe,$e,et,tt;const f=Jt().getLoginUserId(),e=I(!1);(f==null||f==""||f==h.NO_LOGIN_USER)&&Ut.get(route("login"));const te=new _s;te.userId=f,te.deviceToken=localStorage.deviceToken;const R=fs(),re=us(),v=(qe=(Ve=(Ge=i.query)==null?void 0:Ge.buyer_user_id)==null?void 0:Ve.toString())!=null?qe:"",C=(Je=(ze=(je=i.query)==null?void 0:je.seller_user_id)==null?void 0:ze.toString())!=null?Je:"",_=I(""),E=I(""),k=(We=(Ke=(Xe=i.query)==null?void 0:Xe.item_id)==null?void 0:Ke.toString())!=null?We:"",Y=I("");let j=I("");const z=I(""),ie=($e=(Qe=(Ze=i.query)==null?void 0:Ze.chat_flag)==null?void 0:Qe.toString())!=null?$e:h.CHAT_FROM_BUYER,ae=I("0"),Se=new as;Se.userId=f;const H=is(),ue=I(!1);((tt=(et=H==null?void 0:H.appInfo)==null?void 0:et.data)==null?void 0:tt.psAppSetting.SelectedChatType)==h.CHAT_AND_APPOINTMENT&&(ue.value=!0);async function xe(){}xe();const X=rs(),Ae=ls(),K=ss();zt();const F=ns(),W=new ps,S=new ys,o=new _e().ChatParameterHolder(),D=new Ss,G=new ks,T=I(),N=I(),le=I(),s=I(),M=I(),ne=I(),O=I(),De=I(),se=I(!1),Re=I(),L=I(!1),V=b.sortinUserId(C,v),de=Be.database().ref("Message/"+V),Ce=Be.database().ref("Current_Chat_With"),he=Be.database().ref("User_Presence");let q,ce=I("");C==f?q=v:q=C;const Me=os("chat");Me.loadUser(q),G.itemId=k,G.buyerUserId=v,G.sellerUserId=C,ie==h.CHAT_FROM_SELLER?G.type=h.CHAT_TO_BUYER:G.type=h.CHAT_TO_SELLER;const Le=I(""),Ie=Pt({data:[]});async function Z(){var t,p;W.itemId=k,W.buyerUserId=v,W.sellerUserId=C,await X.loadChatHistory(W,f),se.value=!0,((p=(t=X.chatHistory)==null?void 0:t.data)==null?void 0:p.isOffer)=="1"&&(se.value=!1)}function ve(t){t.target.scrollTop<50&&b.log("load more......")}function J(){const t=new Date().getTime();return b.getTimeStampDividedByOneThousand(parseInt(t.toString(),10))}async function lt(t){o.id="",o.addedDateTimeStamp=J(),o.isSold=!1,o.isUserBought=!1,o.itemId=k,o.message=t,o.offerStatus=h.CHAT_STATUS_NULL,o.sendByUserId=f,o.sessionId=V,o.type=h.CHAT_TYPE_TEXT,await B(o,!0)}async function B(t,p=!1){var me;let y;t.id==""?y=(me=de.push().key)!=null?me:"":y=t.id;const u=t.sendByUserId,Q={addedDate:t.addedDateTimeStamp,id:y,isSold:t.isSold,isUserBought:t.isUserBought,itemId:t.itemId,message:t.message,offerStatus:t.offerStatus,sendByUserId:t.sendByUserId,sessionId:t.sessionId,type:t.type},$={itemId:t.itemId,receiverId:q,senderId:u},pe={userId:u,userName:"Tester"};de.child(y).set(Q),Ce.child(u).set($),he.child(u).set(pe);let oe="0";L.value&&(oe="1"),p&&(ie==h.CHAT_FROM_SELLER?X.postChatHistory(k,v,C,h.CHAT_TO_SELLER,oe,t.message,f):X.postChatHistory(k,v,C,h.CHAT_TO_BUYER,oe,t.message,f)),Le.value="",Fe(700)}let ge;function Fe(t){setTimeout(function(){ge!=null?ge.scrollTop=ge.scrollHeight+400:b.log("it null")},t)}function nt(t){var p,y,u;return t.toString()=="0"?x("item_price__free"):cs((u=(y=(p=H==null?void 0:H.appInfo)==null?void 0:p.data)==null?void 0:y.mobileSetting)==null?void 0:u.price_format,t)}wt(async()=>{var u,Q,$,pe,oe,me,st,ot,rt;const t=f,p={itemId:k,receiverId:q,senderId:t},y={userId:f,userName:"Tester"};Ce.child(t).set(p),he.child(f).set(y),await Ae.resetUnreadMessageCount(f,G),re.postUserUnreadMessageCount(te),await Z(),await R.loadItem(k,f),_.value=(u=R.item.data)==null?void 0:u.title,E.value=($=(Q=R.item.data)==null?void 0:Q.category)==null?void 0:$.catName,Y.value=(oe=(pe=R.item.data)==null?void 0:pe.defaultPhoto)==null?void 0:oe.imgPath,j.value=(me=R.item.data)==null?void 0:me.price,z.value=(ot=(st=R.item.data)==null?void 0:st.itemCurrency)==null?void 0:ot.currencySymbol,ae.value=(rt=R.item.data)==null?void 0:rt.isSoldOut,e.value=!0,window.addEventListener("scroll",ve),ge=document.getElementById("messages"),de.orderByChild("itemId").equalTo(k).on("value",Tt=>{Ie.data=[];const be=[];let Ue="",ye=se.value;Tt.forEach(fe=>{const U=fe.val();if(U.key=fe.key,U.offerStatus==h.CHAT_STATUS_REJECT||U.offerStatus==h.CHAT_STATUS_IS_USER_BOUGHT?ye=!0:U.offerStatus==h.CHAT_STATUS_SOLD?(ye=!1,ae.value="1"):ye=se.value,U!=null){if(U.dateTimeString=b.timeStampToDateString(U.addedDate),U.dateTimeString!=null&&U.dateTimeString!=""&&U.dateTimeString.includes(" ")){const it=U.dateTimeString.split(" ");if(U.dateString=it[0],U.timeString=it[1],Ue==""||Ue!=U.dateString){Ue=U.dateString;const we={};we.message=U.dateString,we.type=h.CHAT_TYPE_DATE,be.push(we)}}let Pe=new He;Pe=Pe.fromMap(U),be.push(Pe)}}),se.value=ye,Ie.data=be.reverse(),Fe(1500),he.child(q).on("value",fe=>{fe.val()!=null&&fe.val().userId==q?L.value=!0:L.value=!1})})}),Et(()=>{Ce.child(f).remove(),he.child(f).remove(),window.removeEventListener("scroll",ve)});function dt(){Re.value.click()}async function ct(t){const p=t.target.files;if(p&&p.length>1)b.log(p.length);else{let y;for(let u=0;u<p.length;u++)y=p[u];if(y!=null){T.value.openModal(),T.value.setMessage(x("chat__uploading_image"));let u;f==C?u=h.CHAT_TO_BUYER:u=h.CHAT_TO_SELLER;let Q="0";L.value&&(Q="1");const $=await K.postChatImageUpload(f,C,v,k,u,Q,y);$.status==ee.SUCCESS?(o.addedDateTimeStamp=J(),o.isSold=!1,o.isUserBought=!1,o.itemId=k,o.message=$.data.imgPath,o.offerStatus=h.CHAT_STATUS_NULL,o.sendByUserId=f,o.sessionId=V,o.type=h.CHAT_TYPE_IMAGE,await B(o,!0)):b.log("error"),T.value.closeModal()}}}function mt(){var t,p;((p=(t=H==null?void 0:H.appInfo)==null?void 0:t.data)==null?void 0:p.psAppSetting.SelectedChatType)==h.CHAT_AND_APPOINTMENT?O.value.openModal(_.value,E.value,Y.value,z.value,j.value):ne.value.openModal(_.value,E.value,Y.value,z.value,j.value)}async function ft(t){let p="0";L.value&&(p="1"),S.itemId=k,S.buyerUserId=v,S.sellerUserId=C,S.negoPrice=t,S.type=h.CHAT_TO_SELLER,S.isUserOnline=p,S.message=t,T.value.openModal();const y=await F.makeOffer(v,S);y.status==ee.ERROR?b.log(y.message):(o.id="",o.addedDateTimeStamp=J(),o.isSold=!1,o.isUserBought=!1,o.itemId=k,o.message=t,o.offerStatus=h.CHAT_STATUS_OFFER,o.sendByUserId=f,o.sessionId=V,o.type=h.CHAT_TYPE_OFFER,await B(o)),await Z(),T.value.closeModal()}async function _t(t,p){let y="0";L.value&&(y="1"),S.itemId=k,S.buyerUserId=v,S.sellerUserId=C,S.negoPrice=t,S.type=h.CHAT_TO_SELLER,S.isUserOnline=y,S.message=t,T.value.openModal();const u=await F.makeOffer(v,S);u.status==ee.ERROR?b.log(u.message):(o.id="",o.addedDateTimeStamp=J(),o.isSold=!1,o.isUserBought=!1,o.itemId=k,o.message=p+" "+t,o.offerStatus=h.CHAT_STATUS_OFFER,o.sendByUserId=f,o.sessionId=V,o.type=h.CHAT_TYPE_OFFER,await B(o)),await Z(),T.value.closeModal()}function ut(t){N.value.openModal(x("chat__confirm_title"),x("chat__confirm_to_accept_dialog"),x("chat__confirm"),x("chat__cancel"),()=>{ht(t)},()=>{b.log("cancel")})}async function ht(t){let p="0";L.value&&(p="1"),S.itemId=k,S.buyerUserId=v,S.sellerUserId=C,S.negoPrice=t.message,S.type=h.CHAT_TO_BUYER,S.isUserOnline=p,S.message=t.message,T.value.openModal();const y=await F.acceptOffer(f,S);if(y.status==ee.ERROR)b.log(y.message);else{o.id=t.id,o.isSold=!1,o.isUserBought=!1,o.itemId=t.itemId,o.message=t.message,o.offerStatus=h.CHAT_STATUS_OFFER,o.sendByUserId=t.sendByUserId,o.sessionId=t.sessionId,o.type=h.CHAT_TYPE_ACCEPT,o.addedDateTimeStamp=t.addedDate,await B(o);const u=new _e().ChatAcceptParameterHolder();u.addedDateTimeStamp=J(),u.isSold=!1,u.isUserBought=!1,u.itemId=k,u.message=t.message,u.offerStatus=h.CHAT_STATUS_ACCEPT,u.type=h.CHAT_TYPE_ACCEPT,u.sendByUserId=f,u.sessionId=V,await B(u)}await Z(),T.value.closeModal()}async function Te(t){let p="0";L.value&&(p="1"),D.itemId=k,D.buyerUserId=v,D.sellerUserId=C,D.isUserOnline=p,T.value.openModal();const y=await F.isUserBought(f,D);if(y.status==ee.ERROR)b.log(y.message);else{o.addedDateTimeStamp=t.addedDate,o.isSold=!1,o.isUserBought=!0,o.id=t.id,o.itemId=t.itemId,o.message=t.message,o.offerStatus=h.CHAT_STATUS_ACCEPT,o.sendByUserId=t.sendByUserId,o.sessionId=t.sessionId,o.type=h.CHAT_TYPE_TEXT,await B(o);const u=new _e;u.addedDateTimeStamp=J(),u.isSold=!1,u.isUserBought=!0,u.itemId=k,u.message=t.message,u.offerStatus=h.CHAT_STATUS_IS_USER_BOUGHT,u.sendByUserId=f,u.sessionId=V,u.type=h.CHAT_TYPE_BOUGHT,await B(u)}await Z(),T.value.closeModal()}function gt(t){N.value.openModal(x("item_detail__mark_as_sold_out"),x("item_detail__confirm_to_sold_out"),x("chat__confirm"),x("chat__cancel"),()=>{pt(t)},()=>{b.log("Cancel")})}async function pt(t){D.itemId=k,D.buyerUserId=v,D.sellerUserId=C,T.value.openModal();const p=await F.markAsSold(f,D);if(p.status==ee.ERROR)b.log(p.message);else{o.id=t.id,o.isSold=!0,o.isUserBought=!0,o.itemId=t.itemId,o.message=t.message,o.offerStatus=h.CHAT_STATUS_ACCEPT,o.sendByUserId=t.sendByUserId,o.sessionId=t.sessionId,o.type=h.CHAT_TYPE_TEXT,o.addedDateTimeStamp=t.addedDate,await B(o);const y=new _e;y.addedDateTimeStamp=J(),y.isSold=!0,y.isUserBought=!0,y.itemId=k,y.message=t.message,y.offerStatus=h.CHAT_STATUS_SOLD,y.sendByUserId=f,y.sessionId=V,y.type=h.CHAT_TYPE_SOLD,await B(y)}await Z(),T.value.closeModal()}function yt(t){N.value.openModal(x("chat__reject_title"),x("chat__confirm_to_reject_dialog"),x("chat__confirm"),x("chat__cancel"),()=>{At(t)},()=>{b.log("cancel")})}function kt(t){N.value.openModal(x("chat__user_pickup_title"),x("chat__confirm_to_user_pickup_dialog"),x("chat__confirm"),x("chat__cancel"),()=>{Te(t)},()=>{b.log("cancel")})}function St(t){N.value.openModal(x("chat_book_appoint_done"),x("chat__confirm_to_user_appointment_dialog"),x("chat__confirm"),x("chat__cancel"),()=>{Te(t)},()=>{b.log("cancel")})}function xt(t,p=""){N.value.openModal(x("chat__delete_message_title"),x("chat__confirm_to_delete_dialog"),x("chat__remove"),x("chat__cancel"),()=>{p!=""?Ne(t.id):Ye(t.id,p)},()=>{b.log("cancel"),ce.value=""})}async function At(t){let p="0";L.value&&(p="1"),S.itemId=k,S.buyerUserId=v,S.sellerUserId=C,S.negoPrice="0",S.type=h.CHAT_TO_BUYER,S.isUserOnline=p,S.message=t.message,T.value.openModal();const y=await F.makeOffer(f,S);if(y.status==ee.ERROR)b.log(y.message);else{o.id=t.id,o.isSold=!1,o.isUserBought=!1,o.itemId=t.itemId,o.message=t.message,o.offerStatus=h.CHAT_STATUS_OFFER,o.sendByUserId=t.sendByUserId,o.sessionId=t.sessionId,o.type=h.CHAT_TYPE_REJECT,o.addedDateTimeStamp=t.addedDate,await B(o);const u=new _e().ChatAcceptParameterHolder();u.addedDateTimeStamp=J(),u.isSold=!1,u.isUserBought=!1,u.itemId=k,u.message=t.message,u.offerStatus=h.CHAT_STATUS_REJECT,u.type=h.CHAT_TYPE_REJECT,u.sendByUserId=f,u.sessionId=V,await B(u)}await Z(),T.value.closeModal()}function Ct(t){M.value.openModal(t)}function It(){De.value.openModal(q,()=>{s.value.openModal(x("chat__review_error"))},()=>{le.value.openModal("",x("chat__review_sent"))})}async function Ne(t){await de.child(t).remove()}async function Ye(t,p){await de.child(t).remove(),K.postChatImageDelete(p,f)}function vt(t){ce.value==""?ce.value=t!=null?t:"":ce.value=""}return{dataReady:e,chatHistoryProvider:X,userStore:Me,sellerUserId:C,handleScroll:ve,chats:Ie,chatFlag:ie,sendMessage:B,inputMessageController:Le,itemName:_,itemCategory:E,itemId:k,itemImageName:Y,itemPrice:j,currency:z,PsConst:h,loginUserId:f,otherUserId:q,isOtherUserOnline:L,onImageClick:dt,image:Re,onImageSelected:ct,ps_loading_dialog:T,ps_confirm_dialog:N,makeOfferClicked:mt,offer_modal:ne,booking_modal:O,review_modal:De,submitOffer:_t,submitBooking:ft,offerProvider:F,acceptOffer:ut,rejectOffer:yt,sendNormalMessage:lt,isUserBought:Te,markAsSoldClick:gt,imageView:Ct,chat_image:M,showOffer:se,clickGiveReview:It,ps_error_dialog:s,ps_success_dialog:le,formatPrice:nt,isSoldOut:ae,chatDelete:Ne,chatImageDelete:Ye,userPickup:kt,appointmentDone:St,deleteChatId:ce,showDeleteDropDown:vt,deleteConfirm:xt,moment:hs,appInfoStore:H,isBooking:ue}},computed:{breadcrumb(){return[{label:x("chat__chat_list"),url:route("fe_chat_list")},{label:"Chat",color:"text-fePrimary-500"}]}}},As={class:"relative flex flex-col",style:{height:"90vh"}},Cs={class:"lg:mt-32 mt-28 h-48 flex flex-col"},Is={class:"flex flex-wrap items-center mb-2 mt-2 p-2 bg-feAchromatic-50 rounded dark:bg-feAchromatic-900"},vs={class:"flex flex-row content-end items-center cursor-pointer"},Ts={alt:"Placeholder",width:"300px",height:"200px",class:"w-12 h-12 object-cover bg-feAchromatic-50 rounded-full me-2"},bs={class:"grow"},Us={key:0,class:"flex flex-row items-center"},Ps={key:1,class:"flex flex-row items-center"},ws=c("div",{class:"w-52"},null,-1),Es={key:0},Os={key:0},Bs={key:1},Hs={key:0,class:"flex sm:flex-row justify-between bg-feAchromatic-50 p-2 rounded dark:bg-feAchromatic-900"},Ds={class:"flex flex-row cursor-pointer"},Rs={alt:"Placeholder",class:"w-24 h-16 object-cover bg-feAchromatic-50 rounded-md"},Ms={class:"grow grid grid-col-4 sm:flex sm:justify-between ms-4"},Ls={class:"col-span-2"},Fs={class:"col-span-2 sm:hidden flex items-center justify-end"},Ns={class:"col-span-4 flex items-center me-2"},Ys={key:0,class:"chat"},Gs={key:0},Vs={class:"flex w-full justify-center"},qs={class:"px-4 py-2 mt-2 mb-1 rounded-lg inline-block font-medium"},js={key:1},zs={key:0},Js={key:0,class:"w-full flex justify-end ps-1/3 flex-row items-end"},Xs={class:"px-2 py-4 mt-2 mb-1 rounded-md inline-block rounded-bl-none bg-feInfo-500"},Ks=c("br",null,null,-1),Ws=c("br",null,null,-1),Zs={key:1,class:"pe-1/3 flex flex-col"},Qs={class:"flex flex-row items-end"},$s={class:"px-2 py-4 mt-2 mb-1 rounded-md inline-block rounded-br-none bg-feInfo-500"},eo=c("br",null,null,-1),to=c("br",null,null,-1),so=c("br",{class:"sm:hidden"},null,-1),oo={key:1},ro={key:0,class:"w-full flex justify-end ps-1/3 flex-row items-end"},io={class:"px-4 py-2 mt-2 mb-1 rounded-lg inline-block rounded-bl-none bg-feError-500 text-feAchromatic-50"},ao={key:1,class:"pe-1/3 flex flex-col"},lo={class:"flex flex-row items-end"},no={class:"px-4 py-2 mt-2 mb-1 rounded-lg inline-block rounded-br-none bg-feError-500"},co={key:2},mo={key:0},fo={key:1},_o={key:0,class:"w-full flex flex-col justify-end items-end"},uo={class:"flex flex-row items-end mb-2"},ho={class:"px-2 py-4 rounded-md inline-block rounded-bl-none bg-feSuccess-500"},go={key:0,class:"flex flex-row items-end mb-2"},po={class:"px-2 py-4 rounded-md inline-block rounded-bl-none bg-feInfo-500"},yo={key:1,class:"flex flex-row items-end mb-2"},ko={class:"px-2 py-4 rounded-md inline-block rounded-bl-none bg-feError-500"},So={key:2,class:"flex justify-center w-full mt-5"},xo={key:1,class:"pe-1/3 flex flex-col"},Ao={class:"flex flex-row items-end mb-2"},Co={class:"px-2 py-4 rounded-md inline-block rounded-br-none bg-feSuccess-500"},Io={key:0,class:"flex flex-row items-end mb-2"},vo={class:"px-2 py-4 rounded-md inline-block rounded-br-none bg-feInfo-500"},To={key:1,class:"flex flex-row items-end mb-2"},bo={class:"px-2 py-4 rounded-md inline-block rounded-br-none bg-feError-500"},Uo={key:3},Po={key:0,class:"w-full flex justify-end ps-1/3 flex-row items-end"},wo={class:""},Eo={class:"relative"},Oo=["onClick"],Bo={class:"p-4 mt-2 mb-1 rounded-md inline-block rounded-bl-none bg-feSecondary-100 dark:bg-feAchromatic-800"},Ho={key:1,class:"pe-1/3 flex flex-row items-end"},Do={class:"p-4 mt-2 mb-1 rounded-md inline-block rounded-br-none bg-fePrimary-500"},Ro={key:2},Mo={class:"mt-5 mb-2 grid grid-cols-4 gap-x-4 sm:flex sm:flex-row sm:justify-center rtl:space-x-reverse sm:space-x-3"},Lo={class:"col-span-2"},Fo={key:0,class:"col-span-2"},No={key:3},Yo={class:"w-full mt-5 flex justify-center items-center"},Go={key:4},Vo={key:0,class:"w-full flex justify-end ps-1/3 flex-row items-end"},qo={class:"px-2 py-4 mt-2 mb-1 rounded-md inline-block rounded-bl-none bg-feInfo-500"},jo=c("br",null,null,-1),zo=c("br",null,null,-1),Jo={key:1,class:"flex flex-col"},Xo={class:"flex flex-row items-end"},Ko={class:"px-2 py-4 mt-2 mb-1 rounded-md block rounded-br-none bg-feInfo-500"},Wo=c("br",null,null,-1),Zo=c("br",null,null,-1),Qo={key:0,class:"mt-5 mb-2 grid grid-cols-4 gap-4 sm:flex sm:flex-row sm:justify-center rtl:space-x-reverse sm:space-x-4"},$o={key:5},er={key:0,class:"w-full flex justify-end ps-1/3 flex-row items-end h-48 mt-4"},tr={class:"relative"},sr=["onClick"],or=["onClick"],rr={key:1,class:"pe-1/3 flex flex-row items-end h-48 mt-4"},ir=["onClick"],ar={class:"mt-2 mb-0 sm:mb-0 absolute inset-y-full w-full"},lr={class:"relative flex pt-1 w-full"},nr={type:"button",class:"inline-flex items-center justify-center rounded-full h-10 w-10 transition duration-500 ease-in-out"},dr={class:"grow relative"};function cr(i,r,f,e,te,R){const re=w("Head"),v=w("ps-breadcrumb-2"),C=w("ps-route-link"),_=w("ps-label"),E=w("ps-icon"),k=w("ps-button"),Y=w("ps-label-caption-2"),j=w("ps-input"),z=w("ps-content-container"),ie=w("ps-loading-dialog"),ae=w("ps-confirm-dialog-2"),Se=w("ps-error-dialog"),H=w("ps-success-dialog"),ue=w("chat-image-detail"),xe=w("offer-modal"),X=w("booking-modal"),Ae=w("review-modal"),K=Ht("lazy");return a(),g(at,null,[m(re,{title:i.$t("chat__title")},null,8,["title"]),m(z,{class:"h-screen"},{content:d(()=>{var F,W,S,o,D,G,T,N,le;return[c("div",As,[c("div",Cs,[m(v,{items:R.breadcrumb},null,8,["items"]),c("div",Is,[m(C,{to:{name:"fe_other_profile",query:{userId:(W=(F=e.userStore.user)==null?void 0:F.data)==null?void 0:W.userId}},class:"w-16"},{default:d(()=>{var s,M;return[c("div",vs,[ke(c("img",Ts,null,512),[[K,{src:i.$page.props.thumb1xUrl+"/"+((M=(s=e.userStore.user)==null?void 0:s.data)==null?void 0:M.userCoverPhoto),loading:i.$page.props.sysImageUrl+"/loading_gif.gif",error:i.$page.props.sysImageUrl+"/default_photo.png"}]])])]}),_:1},8,["to"]),c("div",bs,[m(_,{class:"font-medium text-base"},{default:d(()=>{var s,M;return[n(l((M=(s=e.userStore.user)==null?void 0:s.data)==null?void 0:M.userName),1)]}),_:1}),e.isOtherUserOnline?(a(),g("div",Us,[m(E,{name:"dot",w:"10",h:"10",class:"text-feSuccess-300 me-2"}),m(_,null,{default:d(()=>[n(l(i.$t("chat__online")),1)]),_:1})])):(a(),g("div",Ps,[m(E,{name:"dot",w:"10",h:"10",class:"text-feAchromatic-300 me-2"}),m(_,null,{default:d(()=>[n(l(i.$t("chat__offline")),1)]),_:1})]))]),ws,((o=(S=e.appInfoStore.appInfo.data)==null?void 0:S.psAppSetting)==null?void 0:o.SelectedPriceType)!=e.PsConst.PRICE_RANGE?(a(),g("div",Es,[((G=(D=e.appInfoStore.appInfo.data)==null?void 0:D.psAppSetting)==null?void 0:G.SelectedChatType)==e.PsConst.CHAT_AND_OFFER?(a(),g("div",Os,[e.chatFlag==e.PsConst.CHAT_FROM_SELLER?(a(),A(k,{key:0,onClick:Ee(e.makeOfferClicked,["prevent"]),rounded:"rounded",class:"mt-2 sm:mt-0",disabled:!(e.isSoldOut!="1"&&e.showOffer)},{default:d(()=>[n(l(i.$t("chat__make_an_offer")),1)]),_:1},8,["onClick","disabled"])):P("",!0)])):P("",!0)])):P("",!0),((N=(T=e.appInfoStore.appInfo.data)==null?void 0:T.psAppSetting)==null?void 0:N.SelectedChatType)==e.PsConst.CHAT_AND_APPOINTMENT?(a(),g("div",Bs,[e.chatFlag==e.PsConst.CHAT_FROM_SELLER?(a(),A(k,{key:0,onClick:Ee(e.makeOfferClicked,["prevent"]),rounded:"rounded",class:"mt-2 sm:mt-0",disabled:!(e.isSoldOut!="1"&&e.showOffer)},{default:d(()=>[n(l(i.$t("chat_book")),1)]),_:1},8,["onClick","disabled"])):P("",!0)])):P("",!0)]),e.dataReady?(a(),g("div",Hs,[m(C,{to:{name:"fe_item_detail",query:{item_id:e.itemId}}},{default:d(()=>[c("div",Ds,[ke(c("img",Rs,null,512),[[K,{src:i.$page.props.thumb2xUrl+"/"+e.itemImageName,loading:i.$page.props.sysImageUrl+"/loading_gif.gif",error:i.$page.props.sysImageUrl+"/default_photo.png"}]])])]),_:1},8,["to"]),c("div",Ms,[c("div",Ls,[m(_,{textColor:"font-semibold text-fePrimary-500",class:"text-xs sm:text-xl"},{default:d(()=>[n(l(e.itemName),1)]),_:1}),m(_,{class:"font-normal text-lg"},{default:d(()=>[n(l(e.itemCategory),1)]),_:1}),m(_,{class:"font-normal text-xs",textColor:"text-feAchromatic-500"},{default:d(()=>[n(l(e.currency)+" "+l(e.formatPrice(e.itemPrice)),1)]),_:1})]),c("div",Fs,[m(C,{to:{name:"fe_item_detail",query:{item_id:e.itemId}},class:"block sm:hidden"},{default:d(()=>[m(E,{name:"doubleRightArrow"})]),_:1},8,["to"])]),c("div",Ns,[(le=e.appInfoStore)!=null&&le.isSoldOutFeatureSettingOn()?(a(),A(k,{key:0,class:Oe([e.isSoldOut=="1"?"":"hidden","h-[20px] sm:h-[28px]"]),rounded:"rounded",hover:!1},{default:d(()=>[n(l(i.$t("chat__mark_sold_out")),1)]),_:1},8,["class"])):P("",!0),m(C,{to:{name:"fe_item_detail",query:{item_id:e.itemId}},class:"hidden sm:block"},{default:d(()=>[m(E,{name:"doubleRightArrow"})]),_:1},8,["to"])])])])):P("",!0)]),c("div",{ref:"messages",onScroll:r[2]||(r[2]=(...s)=>e.handleScroll&&e.handleScroll(...s)),id:"messages",class:"px-4 flex flex-col-reverse overflow-y-auto mt-14 sm:mt-3 h-full scrolling-touch"},[(a(!0),g(at,null,Ot(e.chats.data,s=>{var M,ne;return a(),g("div",{key:(M=s.id)!=null?M:""},[s.message!=""&&s.message!=null?(a(),g("div",Ys,[s.type==e.PsConst.CHAT_TYPE_DATE?(a(),g("div",Gs,[c("div",Vs,[c("span",qs,[m(_,null,{default:d(()=>[n(l(s.message),1)]),_:2},1024)])])])):s.type==e.PsConst.CHAT_TYPE_TEXT?(a(),g("div",js,[s.offerStatus==e.PsConst.CHAT_STATUS_OFFER?(a(),g("div",zs,[s.sendByUserId==e.loginUserId?(a(),g("div",Js,[m(_,{class:"me-2 mb-1 text-xs font-normal",textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-50"},{default:d(()=>[n(l(s.timeString),1)]),_:2},1024),c("span",Xs,[e.isBooking?(a(),A(_,{key:0,class:"text-center",textColor:"text-feAchromatic-50Dark"},{default:d(()=>[n(l(i.$t("chat_book_make_booking"))+" ",1),Ks,n(l(e.itemPrice=="0"?i.$t("item_price__free"):s.message),1)]),_:2},1024)):(a(),A(_,{key:1,class:"text-center",textColor:"text-feAchromatic-50Dark"},{default:d(()=>[n(l(i.$t("chat__send_offer"))+" ",1),Ws,n(l(e.itemPrice=="0"?i.$t("item_price__free"):s.message),1)]),_:2},1024))])])):(a(),g("div",Zs,[c("div",Qs,[c("span",$s,[e.isBooking?(a(),A(_,{key:0,textColor:"text-feAchromatic-50"},{default:d(()=>[n(l(i.$t("chat_book_received_booking"))+" ",1),eo,n(l(e.itemPrice=="0"?i.$t("item_price__free"):s.message),1)]),_:2},1024)):(a(),A(_,{key:1,textColor:"text-feAchromatic-50"},{default:d(()=>[n(l(i.$t("chat__receive_offer"))+" ",1),to,n(l(e.itemPrice=="0"?i.$t("item_price__free"):s.message),1)]),_:2},1024))]),so,m(_,{class:"ms-2 mb-1 text-xs font-normal",textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-50"},{default:d(()=>[n(l(s.timeString),1)]),_:2},1024)])]))])):s.offerStatus==e.PsConst.CHAT_STATUS_REJECT?(a(),g("div",oo,[s.sendByUserId==e.loginUserId?(a(),g("div",ro,[m(_,{class:"me-2 mb-1 text-xs font-normal",textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-50"},{default:d(()=>[n(l(s.timeString),1)]),_:2},1024),c("span",io,[e.isBooking?(a(),A(_,{key:0,class:"text-center",textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-50"},{default:d(()=>[n(l(i.$t("chat_book_reject")),1)]),_:1})):(a(),A(_,{key:1,class:"text-center",textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-50"},{default:d(()=>[n(l(i.$t("chat__offer_rejected_item")),1)]),_:1}))])])):(a(),g("div",ao,[c("div",lo,[c("span",no,[e.isBooking?(a(),A(_,{key:0,textColor:"text-feAchromatic-50"},{default:d(()=>[n(l(i.$t("chat_book_reject")),1)]),_:1})):(a(),A(_,{key:1,textColor:"text-feAchromatic-50"},{default:d(()=>[n(l(i.$t("chat__offer_rejected_item")),1)]),_:1}))]),m(_,{class:"ms-2 mb-1 text-xs font-normal",textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-50"},{default:d(()=>[n(l(s.timeString),1)]),_:2},1024)])]))])):s.offerStatus==e.PsConst.CHAT_STATUS_ACCEPT?(a(),g("div",co,[s.isSold&&s.isUserBought?(a(),g("div",mo)):(a(),g("div",fo,[s.sendByUserId==e.loginUserId?(a(),g("div",_o,[c("div",uo,[m(_,{class:"me-2 mb-1 text-xs font-normal",textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-400"},{default:d(()=>[n(l(s.timeString),1)]),_:2},1024),c("span",ho,[e.isBooking?(a(),A(_,{key:0,class:"text-center",textColor:"text-feAchromatic-50"},{default:d(()=>[n(l(i.$t("chat_book_accept")),1)]),_:1})):(a(),A(_,{key:1,class:"text-center",textColor:"text-feAchromatic-50"},{default:d(()=>[n(l(i.$t("chat__offer_accepted_item")),1)]),_:1}))])]),s.isUserBought?(a(),g("div",go,[m(_,{class:"me-2 mb-1 text-xs font-normal",textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-400"},{default:d(()=>[n(l(s.timeString),1)]),_:2},1024),c("span",po,[e.isBooking?(a(),A(_,{key:0,class:"text-center",textColor:"text-feAchromatic-50"},{default:d(()=>[n(l(i.$t("chat_book_appoint_done")),1)]),_:1})):(a(),A(_,{key:1,class:"text-center",textColor:"text-feAchromatic-50"},{default:d(()=>[n(l(i.$t("chat__offer_item_pickup")),1)]),_:1}))])])):P("",!0),e.isSoldOut=="1"?(a(),g("div",yo,[m(_,{class:"me-2 mb-1 text-xs font-normal",textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-400"},{default:d(()=>[n(l(s.timeString),1)]),_:2},1024),c("span",ko,[m(_,{class:"text-center",textColor:"text-feAchromatic-50"},{default:d(()=>[n(l(i.$t("chat__offer_item_soldout")),1)]),_:1})])])):P("",!0),s.offerStatus==e.PsConst.CHAT_STATUS_ACCEPT&&s.isUserBought==!1?(a(),g("div",So,[e.isBooking?(a(),A(k,{key:0,onClick:O=>e.appointmentDone(s),colors:"bg-feAchromatic-50 text-fePrimary-500 dark:bg-feAchromatic-800 dark:text-feAchromatic-200 hover:text-feAchromatic-50",focus:"focus:text-feAchromatic-50 focus:bg-fePrimary-500",border:"border border-feAchromatic-300 dark:border-feAchromatic-500"},{default:d(()=>[n(l(i.$t("chat_book_appoint_done")),1)]),_:2},1032,["onClick"])):(a(),A(k,{key:1,onClick:O=>e.userPickup(s),colors:"bg-feAchromatic-50 text-fePrimary-500 dark:bg-feAchromatic-800 dark:text-feAchromatic-200 hover:text-feAchromatic-50",focus:"focus:text-feAchromatic-50 focus:bg-fePrimary-500",border:"border border-feAchromatic-300 dark:border-feAchromatic-500"},{default:d(()=>[n(l(i.$t("chat__user_has_a_pickup")),1)]),_:2},1032,["onClick"]))])):P("",!0)])):(a(),g("div",xo,[c("div",Ao,[c("span",Co,[e.isBooking?(a(),A(_,{key:0,textColor:"text-feAchromatic-50"},{default:d(()=>[n(l(i.$t("chat_book_accept")),1)]),_:1})):(a(),A(_,{key:1,textColor:"text-feAchromatic-50"},{default:d(()=>[n(l(i.$t("chat__offer_accepted_item")),1)]),_:1}))]),m(_,{class:"ms-2 mb-1 text-xs font-normal",textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-50"},{default:d(()=>[n(l(s.timeString),1)]),_:2},1024)]),s.isUserBought?(a(),g("div",Io,[c("span",vo,[e.isBooking?(a(),A(_,{key:0,class:"text-center",textColor:"text-feAchromatic-50"},{default:d(()=>[n(l(i.$t("chat_book_appoint_done")),1)]),_:1})):(a(),A(_,{key:1,class:"text-center",textColor:"text-feAchromatic-50"},{default:d(()=>[n(l(i.$t("chat__offer_item_pickup")),1)]),_:1}))]),m(_,{class:"ms-2 mb-1 text-xs font-normal",textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-400"},{default:d(()=>[n(l(s.timeString),1)]),_:2},1024)])):P("",!0),e.isSoldOut=="1"?(a(),g("div",To,[c("span",bo,[m(_,{class:"text-center",textColor:"text-feAchromatic-50"},{default:d(()=>[n(l(i.$t("chat__offer_item_soldout")),1)]),_:1})]),m(_,{class:"ms-2 mb-1 text-xs font-normal",textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-400"},{default:d(()=>[n(l(s.timeString),1)]),_:2},1024)])):P("",!0)]))]))])):(a(),g("div",Uo,[s.sendByUserId==e.loginUserId?(a(),g("div",Po,[c("div",wo,[m(Y,{onClick:O=>e.showDeleteDropDown(s.id),class:Oe([e.deleteChatId==s.id?"":"del","cursor-pointer rounded float-right"]),textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-400"},{default:d(()=>[m(E,{name:"verticalThreeDot",class:"text-feAchromatic-50Dark"})]),_:2},1032,["onClick","class"]),c("div",Eo,[e.deleteChatId==s.id?(a(),g("div",{key:0,onClick:O=>e.deleteConfirm(s),class:"bg-feAchromatic-50 shadow-sm relative top-4 right-2 px-1 rounded border transform cursor-pointer text-sm dark:bg-feAchromatic-900 dark:text-feAchromatic-50"},l(i.$t("chat__delete_messages")),9,Oo)):P("",!0)]),m(_,{class:"me-2 mb-1 text-xs font-normal",textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-400"},{default:d(()=>[n(l(s.timeString),1)]),_:2},1024)]),c("span",Bo,[m(_,{class:"text-sm"},{default:d(()=>[n(l(s.message),1)]),_:2},1024)])])):(a(),g("div",Ho,[c("span",Do,[m(_,{textColor:"text-feAchromatic-50",class:"text-sm"},{default:d(()=>[n(l(s.message),1)]),_:2},1024)]),m(_,{class:"ms-2 mb-1 text-xs font-normal",textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-400"},{default:d(()=>[n(l(s.timeString),1)]),_:2},1024)]))]))])):s.type==e.PsConst.CHAT_TYPE_BOUGHT?(a(),g("div",Ro,[c("div",Mo,[c("div",Lo,[m(k,{onClick:r[0]||(r[0]=O=>e.clickGiveReview()),colors:"bg-feAchromatic-50 text-fePrimary-500 dark:bg-feAchromatic-800 dark:text-feAchromatic-200 hover:text-feAchromatic-50",border:"border border-feAchromatic-300 dark:border-feAchromatic-500"},{default:d(()=>[n(l(i.$t("chat__leave_a_review")),1)]),_:1})]),s.sendByUserId==e.loginUserId&&s.offerStatus==e.PsConst.CHAT_STATUS_IS_USER_BOUGHT&&((ne=e.appInfoStore)==null?void 0:ne.isSoldOutFeatureSettingOn())?(a(),g("div",Fo,[m(k,{onClick:O=>e.markAsSoldClick(s),class:"w-full",colors:"bg-fePrimary-500 text-feAchromatic-50 dark:bg-feAchromatic-800 dark:text-feAchromatic-200 hover:text-feAchromatic-50",border:"border border-feAchromatic-300 dark:border-feAchromatic-500"},{default:d(()=>[n(l(i.$t("chat__mark_sold_out")),1)]),_:2},1032,["onClick"])])):P("",!0)])])):s.type==e.PsConst.CHAT_TYPE_SOLD?(a(),g("div",No,[c("div",Yo,[c("div",null,[m(k,{onClick:r[1]||(r[1]=O=>e.clickGiveReview()),class:"h-9",colors:"bg-feAchromatic-50 text-fePrimary-500 dark:bg-feAchromatic-800 dark:text-feAchromatic-200 hover:text-feAchromatic-50",border:"border border-feAchromatic-300 dark:border-feAchromatic-500"},{default:d(()=>[n(l(i.$t("chat__leave_a_review")),1)]),_:1})])])])):s.type==e.PsConst.CHAT_TYPE_OFFER?(a(),g("div",Go,[s.sendByUserId==e.loginUserId?(a(),g("div",Vo,[m(_,{class:"me-2 mb-1 text-xs font-normal",textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-400"},{default:d(()=>[n(l(s.timeString),1)]),_:2},1024),c("span",qo,[e.isBooking?(a(),A(_,{key:0,class:"text-center",textColor:"text-feAchromatic-50Dark"},{default:d(()=>[n(l(i.$t("chat_book_make_booking"))+" ",1),jo,n(l(e.itemPrice=="0"?i.$t("item_price__free"):s.message),1)]),_:2},1024)):(a(),A(_,{key:1,class:"text-center",textColor:"text-feAchromatic-50Dark"},{default:d(()=>[n(l(i.$t("chat__send_offer"))+" ",1),zo,n(l(e.itemPrice=="0"?i.$t("item_price__free"):s.message),1)]),_:2},1024))])])):(a(),g("div",Jo,[c("div",Xo,[c("span",Ko,[e.isBooking?(a(),A(_,{key:0,class:"dark:text-feAchromatic-800",textColor:"text-feAchromatic-50"},{default:d(()=>[n(l(i.$t("chat_book_received_booking"))+" ",1),Wo,n(l(e.itemPrice=="0"?i.$t("item_price__free"):s.message),1)]),_:2},1024)):(a(),A(_,{key:1,class:"dark:text-feAchromatic-800",textColor:"text-feAchromatic-50"},{default:d(()=>[n(l(i.$t("chat__receive_offer"))+" ",1),Zo,n(l(e.itemPrice=="0"?i.$t("item_price__free"):s.message),1)]),_:2},1024))]),m(_,{class:"ms-2 mb-2 text-xs font-normal",textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-50"},{default:d(()=>[n(l(s.timeString),1)]),_:2},1024)]),s.offerStatus==e.PsConst.CHAT_STATUS_OFFER?(a(),g("div",Qo,[m(k,{onClick:O=>e.acceptOffer(s),class:"col-span-2 sm:w-[140px] h-9",textSize:"font-normal text-xxs lg:text-sm",colors:"bg-feSuccess-600 cursor-pointer text-feAchromatic-50",rounded:"rounded",hover:"hover:bg-feSuccess-700",focus:"focus:bg-feSuccess-700"},{default:d(()=>[n(l(i.$t("chat__accept")),1)]),_:2},1032,["onClick"]),m(k,{onClick:O=>e.rejectOffer(s),class:"col-span-2 sm:w-[140px] h-9",textSize:"font-normal text-xxs lg:text-sm",colors:"text-fePrimary-500 dark:bg-feAchromatic-800 dark:text-feAchromatic-200 hover:text-feAchromatic-50",focus:"focus:text-feAchromatic-50 focus:bg-fePrimary-500",border:"border border-feAchromatic-300 dark:border-feAchromatic-500",rounded:"rounded"},{default:d(()=>[n(l(i.$t("chat__reject")),1)]),_:2},1032,["onClick"])])):P("",!0)]))])):s.type==e.PsConst.CHAT_TYPE_IMAGE?(a(),g("div",$o,[s.sendByUserId==e.loginUserId?(a(),g("div",er,[c("div",tr,[m(Y,{onClick:O=>e.showDeleteDropDown(s.id),class:Oe([e.deleteChatId==s.id?"":"del","cursor-pointer rounded float-right"]),textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-400"},{default:d(()=>[m(E,{name:"verticalThreeDot",class:"text-feAchromatic-50Dark"})]),_:2},1032,["onClick","class"]),e.deleteChatId==s.id?(a(),g("div",{key:0,onClick:O=>e.deleteConfirm(s,s.message),class:"bg-feAchromatic-50 shadow-sm absolute top-4 right-2 p-1 rounded border cursor-pointer transform"},l(i.$t("chat__delete_messages")),9,sr)):P("",!0),m(_,{class:"me-2 mb-1 text-xs font-normal",textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-400"},{default:d(()=>[n(l(s.timeString),1)]),_:2},1024)]),ke(c("img",{onClick:O=>e.imageView(s.message),width:"300px",height:"200px",alt:"Placeholder",class:"cursor-pointer w-auto h-48 p-2 object-cover rounded-md"},null,8,or),[[K,{src:i.$page.props.thumb3xUrl+"/"+s.message,loading:i.$page.props.sysImageUrl+"/loading_gif.gif",error:i.$page.props.sysImageUrl+"/default_photo.png"}]])])):(a(),g("div",rr,[ke(c("img",{onClick:O=>e.imageView(s.message),width:"300px",height:"200px",alt:"Placeholder",class:"cursor-pointer w-auto h-48 p-2 object-cover rounded-md"},null,8,ir),[[K,{src:i.$page.props.thumb3xUrl+"/"+s.message,loading:i.$page.props.sysImageUrl+"/loading_gif.gif",error:i.$page.props.sysImageUrl+"/default_photo.png"}]]),m(_,{class:"me-2 mb-1 text-xs font-normal",textColor:"text-feAchromatic-50Dark dark:text-feAchromatic-400"},{default:d(()=>[n(l(s.timeString),1)]),_:2},1024)]))])):P("",!0)])):P("",!0)])}),128))],544),c("div",ar,[c("div",lr,[c("div",{for:"upload-image1",onClick:r[4]||(r[4]=(...s)=>e.onImageClick&&e.onImageClick(...s))},[c("input",{class:"py-2",type:"file",size:"1",max:"1",accept:".jpg,.jpeg,.png",onChange:r[3]||(r[3]=s=>e.onImageSelected(s)),ref:"image",id:"upload-image1",style:{display:"none"},ordering:1},null,544),c("button",nr,[m(E,{name:"camera",textColor:"text-fePrimary-500 dark:text-fePrimary-500"})])]),c("div",dr,[m(j,{placeholder:i.$t("chat__type_message"),onKeyup:r[5]||(r[5]=Bt(s=>e.sendNormalMessage(e.inputMessageController),["enter"])),value:e.inputMessageController,"onUpdate:value":r[6]||(r[6]=s=>e.inputMessageController=s),class:"mt-1",theme:"form-input dark:bg-feAchromatic-800 text-feSecondary-500 dark:text-feAchromatic-50"},null,8,["placeholder","value"]),c("button",{type:"button",onClick:r[7]||(r[7]=Ee(s=>e.sendNormalMessage(e.inputMessageController),["prevent"])),class:"absolute right-3 top-3"},[m(E,{name:"send",textColor:"text-fePrimary-500 dark:text-fePrimary-500"})])])])])])]}),_:1}),m(ie,{ref:"ps_loading_dialog"},null,512),m(ae,{ref:"ps_confirm_dialog"},null,512),m(Se,{ref:"ps_error_dialog"},null,512),m(H,{ref:"ps_success_dialog"},null,512),m(ue,{ref:"chat_image"},null,512),m(xe,{ref:"offer_modal",price:e.itemPrice,onSubmit:e.submitOffer},null,8,["price","onSubmit"]),m(X,{ref:"booking_modal",price:e.itemPrice,onSubmit:e.submitBooking},null,8,["price","onSubmit"]),m(Ae,{ref:"review_modal"},null,512)],64)}var $i=gs(xs,[["render",cr]]);export{$i as default};
